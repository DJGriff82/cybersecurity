<h1>Users for <%= @company.name %></h1>

<p><strong>Active Users:</strong>
    <%= @company.users.where(deleted_at: nil).count %> /
    <%= @company.max_users %>
</p>

<div class="filters">
    <%= link_to "Active", super_company_users_path(@company, filter: "active"),
              class: (params[:filter].nil? || params[:filter] == "active" ? "active" : "") %> |
    <%= link_to "Archived", super_company_users_path(@company, filter: "archived"),
              class: (params[:filter] == "archived" ? "active" : "") %> |
    <%= link_to "All", super_company_users_path(@company, filter: "all"),
              class: (params[:filter] == "all" ? "active" : "") %>
</div>

<%= link_to "Add New User", new_super_company_user_path(@company) %> |
<%= link_to "Back to Company", super_company_path(@company) %>
<%= form_with url: import_super_company_users_path(@company), local: true, multipart: true do |form| %>
<p>
    <%= form.label :file, "Import Users from CSV" %><br>
    <%= form.file_field :file, accept: ".csv" %>
</p>
<%= form.submit "Upload CSV" %>
<% end %>
<table>
    <thead>
        <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Role</th>
            <th>Status</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        <% @users.each do |user| %>
        <tr class="<%= 'archived' if user.deleted_at.present? %>">
            <td><%= user.full_name %></td>
            <td><%= user.email %></td>
            <td><%= user.role.humanize %></td>
            <td><%= user.deleted_at.present? ? "Disabled" : "Active" %></td>
            <td>
                <%= link_to "Edit", edit_super_company_user_path(@company, user) %> |

                <% if user.deleted_at.present? %>
                <%= button_to "Enable",
                          toggle_active_super_user_path(user),
                          method: :patch,
                          form: { style: "display:inline;" },
                          data: { confirm: "Are you sure you want to re-enable this user?" },
                          class: "link-button" %>
                <% else %>
                <%= button_to "Disable",
                          toggle_active_super_user_path(user),
                          method: :patch,
                          form: { style: "display:inline;" },
                          data: { confirm: "Are you sure you want to disable this user?" },
                          class: "link-button" %>
                <% end %>
            </td>
        </tr>
        <% end %>
    </tbody>
</table>